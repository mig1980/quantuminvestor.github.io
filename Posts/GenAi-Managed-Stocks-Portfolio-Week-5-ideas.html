<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Week 5 Prototype Enhancements – GenAi Portfolio</title>
  <meta name="description" content="Prototype UX/analytics enhancements for Week 5 AI-managed portfolio update." />
  <link rel="canonical" href="https://quantuminvestor.net/Posts/GenAi-Managed-Stocks-Portfolio-Week-5-ideas.html" />
  <link rel="icon" href="../Media/favicon.ico" />
  <link rel="stylesheet" href="../styles.css" />
  <script src="../js/template-loader.js" defer></script>
  <script src="../js/mobile-menu.js" defer></script>
  <style>
    body { font-family: system-ui, sans-serif; }
    .tldr-strip { display:grid; grid-template-columns: repeat(auto-fit,minmax(140px,1fr)); gap:.75rem; background:#111; border:1px solid #222; padding:.75rem 1rem; border-radius:.75rem; position:sticky; top:0; z-index:30; }
    .tldr-metric { display:flex; flex-direction:column; align-items:flex-start; }
    .tldr-metric span:first-child { font-size:.65rem; text-transform:uppercase; letter-spacing:.08em; color:#888; }
    .tldr-metric span:last-child { font-weight:600; font-size:.95rem; }
    .panel { background:#0c0c0c; border:1px solid #222; padding:1.25rem 1.25rem 1rem; border-radius:.75rem; margin-bottom:1.25rem; }
    .panel h2 { margin:0 0 .75rem; font-size:1.15rem; font-weight:600; }
    .spark-set { display:flex; gap:1rem; flex-wrap:wrap; }
    .spark { display:flex; flex-direction:column; gap:.35rem; }
    .spark svg { width:120px; height:32px; } .spark-label { font-size:.65rem; letter-spacing:.05em; color:#aaa; }
    .slider-wrap { margin:1rem 0; }
    input[type=range] { width:100%; }
    .narrative-box { font-size:.9rem; background:#121212; border:1px solid #262626; padding:.75rem 1rem; border-radius:.5rem; min-height:70px; }
    .collapse-btn { background:#181818; border:1px solid #252525; padding:.55rem .9rem; font-size:.75rem; text-transform:uppercase; letter-spacing:.07em; border-radius:.5rem; cursor:pointer; }
    .collapsed .collapsible-content { display:none; }
    .hero-automation pre, .snippet-cards pre, .provenance pre { background:#161616; padding:.75rem 1rem; overflow:auto; font-size:.7rem; }
    .week-nav { display:flex; gap:.5rem; flex-wrap:wrap; margin:.75rem 0 1.25rem; }
    .week-nav button { background:#141414; border:1px solid #262626; padding:.45rem .75rem; font-size:.7rem; border-radius:.4rem; cursor:pointer; }
    .week-nav button.active { border-color:#7e5bef; color:#c8b8ff; }
    .week-nav button.future { opacity:.35; cursor:not-allowed; }
    .ai-log { font-size:.7rem; line-height:1.05rem; display:grid; gap:.35rem; }
    .badge { display:inline-block; padding:.2rem .45rem; font-size:.55rem; background:#222; border:1px solid #333; border-radius:.35rem; letter-spacing:.05em; }
    .alpha-positive { color:#4ade80; } .alpha-negative { color:#f87171; }
    @media (max-width:640px){ .spark svg { width:100px; } }
  </style>
</head>
<body class="bg-black text-white">
  <div data-template="header" data-root-path="../"></div>
  <main class="container mx-auto px-4 py-10 max-w-5xl">
    <h1 class="text-3xl font-bold mb-6">Week 5 Prototype Enhancements (Preview Sandbox)</h1>
    <p class="text-gray-400 mb-6 text-sm">This page hosts <strong>prototype implementations</strong> of the UX / analytics ideas you listed. Data-driven elements pull from <code>master.json</code>. Several visualizations use placeholder logic for now and mark areas needing refinement. Review each module and we can iterate before integrating into the canonical Week 5 article.</p>

    <!-- TLDR STRIP -->
    <div id="tldrStrip" class="tldr-strip" aria-label="Weekly summary strip">
      <div class="tldr-metric"><span>Week Change</span><span id="tldrWeek">--</span></div>
      <div class="tldr-metric"><span>Since Inception</span><span id="tldrTotal">--</span></div>
      <div class="tldr-metric"><span>Alpha vs SPX (Total)</span><span id="tldrAlpha">--</span></div>
    </div>

    <!-- HISTORICAL ARCHIVE NAVIGATOR -->
    <div class="panel">
      <h2>Historical Archive Navigator</h2>
      <div class="week-nav" id="weekNav" role="tablist" aria-label="Historical weeks"></div>
      <p class="text-xs text-gray-400">Future weeks are styled disabled. Clicking a completed week updates slider & narrative context below.</p>
    </div>

    <!-- NORMALIZED TIMELINE SLIDER -->
    <div class="panel">
      <h2>Normalized Timeline Slider</h2>
      <div class="slider-wrap">
        <input type="range" id="timelineSlider" min="0" max="0" value="0" aria-label="Scrub through normalized timeline" />
      </div>
      <div class="narrative-box" id="timelineNarrative">Scrub to view evolving relative performance.</div>
      <small class="text-gray-500">Values normalized to 100 at inception for each series.</small>
    </div>

    <!-- RISK DASHBOARD -->
    <div class="panel">
      <h2>Risk Dashboard (Prototype)</h2>
      <p class="text-xs text-gray-400 mb-2">Inline mini charts preview dispersion & capture. Final version can compute rolling windows (e.g., last 3–5 weeks) and volatility ratios (portfolio stdev / SPX stdev).</p>
      <div class="spark-set" id="sparkContainer"></div>
    </div>

    <!-- AI CHANGE LOG -->
    <div class="panel">
      <h2>AI Change Log (Hypothetical Signals)</h2>
      <div class="ai-log" id="aiLog">
        <div><span class="badge">NO-TRADE</span> No rebalancing threshold triggered (weekly drawdowns within tolerance).</div>
        <div><span class="badge">MOMENTUM</span> Storage & infrastructure cohort retains elevated relative strength score.</div>
        <div><span class="badge">RISK-MONITOR</span> Cruise exposure (RCL) recovering off oversold – risk flag cleared.</div>
        <div><span class="badge">VOL-TILT</span> Mild volatility compression vs. SPX; no defensive overlay required.</div>
      </div>
      <p class="text-xs text-gray-500 mt-2">Future automation: generate this box by evaluating rules (drawdown, regime shifts, factor drift) inside the Python pipeline and injecting JSON → HTML.</p>
    </div>

    <!-- PROGRESSIVE DISCLOSURE SECTIONS -->
    <div class="panel collapsible" id="analysisBlock">
      <h2>Expanded Analysis (Progressive Disclosure)</h2>
      <button class="collapse-btn" data-target="#analysisBlock">Expand Analysis</button>
      <div class="collapsible-content mt-4 text-sm leading-relaxed text-gray-300">
        <p><strong>Performance Context:</strong> Portfolio weekly drift slightly negative (-0.07%) while SPX modestly positive (+0.26%). Alpha consolidation as prior weeks of outperformance compress relative spread.</p>
        <p><strong>Factor Behavior:</strong> AI basket still skewed toward data infrastructure & diversified industrial cyclicals; energy & metals stabilizing idiosyncratic volatility.</p>
        <p><strong>Forward Watch:</strong> If storage momentum decays two consecutive weeks or volatility ratio >1.4 triggers, model may promote healthcare or low beta industrial into rotation candidate list.</p>
      </div>
    </div>

    <!-- DATA PROVENANCE PANEL -->
    <div class="panel provenance">
      <h2>Data Provenance</h2>
      <ul class="text-xs text-gray-300 space-y-1">
        <li><strong>Prices:</strong> Extracted from automation script (portfolio & benchmarks).</li>
        <li><strong>Inception References:</strong> Hard-coded baseline values from <code>master.json</code> meta/benchmarks.</li>
        <li><strong>Transformations:</strong> Normalization to 100, weekly % deltas, total % since inception.</li>
        <li><strong>Derived Metrics:</strong> Alpha vs SPX (portfolio total % - SPX total %).</li>
        <li><strong>Integrity Checks:</strong> Array length parity (portfolio_history vs benchmarks histories).</li>
      </ul>
      <p class="text-xs text-gray-500 mt-2">Enhancement: Add cryptographic hash of raw source snapshot for audit trail.</p>
    </div>

    <!-- HERO IMAGE AUTOMATION DOC -->
    <div class="panel hero-automation">
      <h2>Hero Image Automation (Python Pillow)</h2>
      <p class="text-xs text-gray-300 mb-2">Concept: programmatically generate weekly hero assets embedding mini-performance chart + headline.</p>
      <pre><code>from PIL import Image, ImageDraw, ImageFont
import json, pathlib

TEMPLATE = 'Media/HeroTemplateBase.png'
OUT = 'Media/W5_auto.webp'
FONT = 'Media/Fonts/Inter-Bold.ttf'

with open('master data/master.json') as f:
    data = json.load(f)
pts = [p['genai_norm'] for p in data['normalized_chart']]
W,H = 1200, 800
img = Image.open(TEMPLATE).convert('RGBA')
d = ImageDraw.Draw(img)
# Mini sparkline
mx = max(pts); mn = min(pts)
coords = []
for i,v in enumerate(pts):
    x = 900 + (i/(len(pts)-1))*250
    y = 500 + (1 - (v-mn)/(mx-mn))*120
    coords.append((x,y))
d.line(coords, fill=(126,91,239,255), width=4, joint='curve')
# Headline
fnt = ImageFont.truetype(FONT, 56)
d.text((60,60), 'Week 5: +3.88% Since Inception', font=fnt, fill='white')
img.save(OUT, quality=90, method=6)
</code></pre>
      <p class="text-xs text-gray-500">Next: integrate into automation pipeline, store with deterministic naming (e.g., <code>W{week}.webp</code>).</p>
    </div>

    <!-- SHAREABLE SNIPPET CARDS DOC -->
    <div class="panel snippet-cards">
      <h2>Shareable Snippet Cards (Open Graph 1200x630)</h2>
      <p class="text-xs text-gray-300 mb-2">Option A: Headless browser (Playwright) render hidden HTML template → screenshot. Option B: Node canvas draw primitives + chart.</p>
      <pre><code>// Playwright example (Node.js)
import { chromium } from 'playwright';
import fs from 'fs';
const template = fs.readFileSync('og-card-template.html','utf8')
// inject dynamic numbers
const html = template
  .replace('{{WEEK}}','5')
  .replace('{{WEEKLY_PCT}}','-0.07%')
  .replace('{{TOTAL_PCT}}','3.88%')
  .replace('{{ALPHA_SPX}}','+3.14%');
(async () => {
  const browser = await chromium.launch();
  const page = await browser.newPage({viewport:{width:1200,height:630}});
  await page.setContent(html, { waitUntil: 'networkidle' });
  await page.screenshot({ path: 'Media/OG-W5.png' });
  await browser.close();
})();
</code></pre>
      <p class="text-xs text-gray-500">Enhancement: add color-coding alpha positive/negative; embed mini sparkline; incorporate brand font.</p>
    </div>

    <p class="text-[0.6rem] text-gray-600 mt-10">Prototype page – not indexed. When approved, merge selected modules into canonical Week 5 post and generalize for future weeks.</p>
  </main>
  <div data-template="footer" data-root-path="../"></div>

<script>
(async function init(){
  const res = await fetch('../master data/master.json');
  const data = await res.json();
  const portfolio = data.portfolio_history;
  const spx = data.benchmarks.sp500.history;
  // TLDR strip
  const latestP = portfolio[portfolio.length-1];
  const latestSPX = spx[spx.length-1];
  const weekPct = latestP.weekly_pct.toFixed(2) + '%';
  const totalPct = latestP.total_pct.toFixed(2) + '%';
  const alpha = (latestP.total_pct - latestSPX.total_pct).toFixed(2) + '%';
  document.getElementById('tldrWeek').textContent = weekPct;
  document.getElementById('tldrTotal').textContent = totalPct;
  const alphaEl = document.getElementById('tldrAlpha');
  alphaEl.textContent = alpha;
  alphaEl.classList.add(parseFloat(alpha) >= 0 ? 'alpha-positive':'alpha-negative');

  // Week nav
  const weekNav = document.getElementById('weekNav');
  portfolio.forEach((p,i)=>{
    const btn = document.createElement('button');
    btn.textContent = 'Week ' + (i===0? '0 (Inception)' : i);
    if(i===portfolio.length-1){ btn.classList.add('active'); }
    btn.dataset.index = i;
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.week-nav button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      timelineSlider.value = i;
      updateTimelineNarrative(i);
    });
    weekNav.appendChild(btn);
  });
  // Future weeks placeholder
  for(let future=portfolio.length; future<10; future++){
    const fbtn = document.createElement('button');
    fbtn.textContent = 'Week ' + future; fbtn.classList.add('future');
    weekNav.appendChild(fbtn);
  }

  // Timeline slider
  const normalized = data.normalized_chart;
  const slider = document.getElementById('timelineSlider');
  slider.max = normalized.length - 1;
  slider.addEventListener('input', e => updateTimelineNarrative(parseInt(e.target.value)));
  function updateTimelineNarrative(idx){
    const row = normalized[idx];
    const prev = normalized[Math.max(idx-1,0)];
    const delta = (row.genai_norm - prev.genai_norm).toFixed(2);
    const relAlpha = (row.genai_norm - row.spx_norm).toFixed(2);
    document.getElementById('timelineNarrative').innerHTML = `Date: <strong>${row.date}</strong><br>Portfolio norm: ${row.genai_norm.toFixed(2)} | SPX norm: ${row.spx_norm.toFixed(2)} | BTC norm: ${row.btc_norm.toFixed(2)}<br>1-period change: ${delta}% | Cumulative alpha vs SPX: <span class="${relAlpha>=0?'alpha-positive':'alpha-negative'}">${relAlpha}%</span>`;
  }
  updateTimelineNarrative(normalized.length-1);

  // Risk dashboard sparks (placeholder calculations)
  const sparkDefs = [
    { id:'dispersion', label:'Weekly Dispersion (Port - SPX)', values: portfolio.map((p,i)=>{ const sp= spx[i]||spx[spx.length-1]; return (p.weekly_pct||0) - (sp.weekly_pct||0); })},
    { id:'capture_up', label:'Up Capture (Port / SPX when SPX>0)', values: portfolio.map((p,i)=>{ const sp= spx[i]; return (sp && sp.weekly_pct>0)? (p.weekly_pct||0)/(sp.weekly_pct||1): 0; })},
    { id:'capture_down', label:'Down Capture (Port / SPX when SPX<0)', values: portfolio.map((p,i)=>{ const sp= spx[i]; return (sp && sp.weekly_pct<0)? (p.weekly_pct||0)/(sp.weekly_pct||1): 0; })},
    { id:'vol_ratio', label:'Vol Ratio (Prototype)', values: (function(){ // simple absolute weekly pct proxy
        const pAbs = portfolio.map(p=>Math.abs(p.weekly_pct||0));
        const sAbs = spx.map(s=>Math.abs(s.weekly_pct||0));
        return pAbs.map((v,i)=> sAbs[i]? v/(sAbs[i]||1): 0);
    })() }
  ];
  const sparkContainer = document.getElementById('sparkContainer');
  sparkDefs.forEach(def=>{
    const div = document.createElement('div'); div.className='spark';
    const label = document.createElement('div'); label.className='spark-label'; label.textContent = def.label; div.appendChild(label);
    const svg = document.createElementNS('http://www.w3.org/2000/svg','svg'); svg.setAttribute('viewBox','0 0 120 32');
    const vals = def.values; const min = Math.min(...vals); const max = Math.max(...vals); const range = (max-min)||1;
    let path=''; vals.forEach((v,i)=>{ const x = (i/(vals.length-1))*120; const y = 16 - ((v-min)/range)*28; path += (i===0? 'M':'L')+x.toFixed(2)+','+y.toFixed(2)+' '; });
    const pth = document.createElementNS('http://www.w3.org/2000/svg','path'); pth.setAttribute('d',path.trim()); pth.setAttribute('fill','none'); pth.setAttribute('stroke','#7e5bef'); pth.setAttribute('stroke-width','2'); pth.setAttribute('stroke-linejoin','round'); pth.setAttribute('stroke-linecap','round'); svg.appendChild(pth);
    // zero line
    const zeroY = 16 - ((0-min)/range)*28;
    const zl = document.createElementNS('http://www.w3.org/2000/svg','line'); zl.setAttribute('x1','0'); zl.setAttribute('x2','120'); zl.setAttribute('y1',zeroY); zl.setAttribute('y2',zeroY); zl.setAttribute('stroke','#333'); zl.setAttribute('stroke-width','1'); svg.appendChild(zl);
    div.appendChild(svg); sparkContainer.appendChild(div);
  });

  // Progressive disclosure
  document.querySelectorAll('.collapse-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const target = document.querySelector(btn.dataset.target);
      target.classList.toggle('collapsed');
      btn.textContent = target.classList.contains('collapsed')? 'Expand Analysis':'Collapse Analysis';
    });
    // initialize collapsed state
    const t = document.querySelector(btn.dataset.target); t.classList.add('collapsed');
  });
})();
</script>
</body>
</html>