<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixabay Hero Image Fetcher - Quantum Investor Digest</title>
    <meta name="description" content="Search and download high-quality hero images from Pixabay. Customize dimensions, apply filters, and get professional visuals instantly.">
    <meta name="author" content="Michael Gavrilov">
    <meta name="theme-color" content="#000000">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'nonce-qi123' https://pixabay.com; style-src 'self' 'nonce-qi123'; img-src 'self' data: https://pixabay.com https://cdn.pixabay.com https://images.pexels.com; font-src 'self' data:; connect-src 'self' https://pixabay.com https://api.pexels.com https://api.github.com; frame-src 'none'; base-uri 'self'; form-action 'self';">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta name="robots" content="noindex, nofollow">
    <link rel="canonical" href="https://quantuminvestor.net/pixabay-fetcher.html">
    <link rel="icon" href="Media/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="styles.css">
    <style nonce="qi123">
        body.bg-black {
            min-height: 100vh;
        }

        .pixabay-container {
            max-width: 1220px;
        }

        .pixabay-hero {
            position: relative;
            padding: 2.75rem 2.5rem;
            border-radius: 1.25rem;
            border: 1px solid rgba(168, 85, 247, 0.4);
            background: radial-gradient(circle at 0% 0%, rgba(168, 85, 247, 0.15), transparent 55%),
                        radial-gradient(circle at 100% 100%, rgba(59, 130, 246, 0.12), transparent 55%),
                        linear-gradient(135deg, rgba(10, 10, 10, 0.95), rgba(15, 23, 42, 0.95));
            overflow: hidden;
        }

        .pixabay-hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% -10%, rgba(148, 163, 184, 0.15), transparent 40%);
            pointer-events: none;
        }

        .pixabay-hero::after {
            content: '';
            position: absolute;
            bottom: -140px;
            right: -120px;
            width: 320px;
            height: 320px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(168, 85, 247, 0.35), transparent 60%);
        }

        .pixabay-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 0.85rem;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            background-color: rgba(17, 24, 39, 0.6);
            color: var(--text-gray-400);
            font-size: 0.75rem;
            letter-spacing: 0.14em;
            text-transform: uppercase;
        }

        .pixabay-pill::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 30%, #ffffff, var(--primary));
        }

        .pixabay-title {
            font-size: clamp(2.4rem, 4vw, 3.25rem);
            letter-spacing: -0.015em;
        }

        .pixabay-hero-copy {
            max-width: 100%;
        }

        .pixabay-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            margin-top: 2rem;
        }

        .pixabay-meta-card {
            padding: 0.9rem 1rem;
            border-radius: 0.75rem;
            background-color: rgba(17, 24, 39, 0.65);
            border: 1px solid rgba(168, 85, 247, 0.25);
        }

        .pixabay-meta-label {
            font-size: 0.7rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--text-gray-500);
        }

        .pixabay-meta-value {
            font-size: 1.15rem;
            font-weight: 600;
            margin-top: 0.35rem;
        }

        .pixabay-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .api-key-btn {
            background: linear-gradient(135deg, var(--primary), rgba(168, 85, 247, 0.5));
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            border: 1px solid transparent;
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
        }

        .api-key-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 12px 30px rgba(168, 85, 247, 0.25);
        }

        .pixabay-panel {
            background-color: var(--bg-gray-900);
            border: 1px solid var(--border-gray-800);
            border-radius: 1rem;
            padding: 1.75rem;
            box-shadow: 0 25px 45px rgba(2, 6, 23, 0.45);
        }

        .pixabay-panel h2 {
            font-size: 1.2rem;
            margin-bottom: 1.25rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-white);
        }

        input[type="text"],
        input[type="number"],
        select {
            background-color: var(--bg-gray-800);
            color: var(--text-white);
            border: 1px solid var(--border-gray-800);
            border-radius: 0.75rem;
            padding: 0.75rem 0.9rem;
            font-size: 0.95rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.25);
            outline: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.85), rgba(59, 130, 246, 0.85));
            color: #ffffff;
            border: 1px solid rgba(168, 85, 247, 0.4);
            border-radius: 0.9rem;
            padding: 0.85rem 1rem;
            font-weight: 600;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            gap: 0.65rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 40px rgba(58, 131, 247, 0.28);
        }

        .btn-primary:disabled {
            opacity: 0.45;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }

        .status {
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
            border: 1px solid transparent;
            display: none;
            font-weight: 500;
        }

        .status.success {
            background-color: rgba(34, 197, 94, 0.12);
            border-color: rgba(34, 197, 94, 0.4);
            color: #4ade80;
        }

        .status.error {
            background-color: rgba(248, 113, 113, 0.12);
            border-color: rgba(248, 113, 113, 0.4);
            color: #f87171;
        }

        .status.loading {
            background-color: rgba(168, 85, 247, 0.12);
            border-color: rgba(168, 85, 247, 0.4);
            color: var(--primary);
        }

        .help-text {
            font-size: 0.85rem;
            color: var(--text-gray-500);
        }

        .pixabay-tip-list {
            display: grid;
            gap: 0.75rem;
            font-size: 0.9rem;
            color: var(--text-gray-400);
            list-style: none;
            padding: 0;
        }

        .pixabay-tip-list li {
            display: flex;
            gap: 0.6rem;
        }

        .pixabay-tip-list li::before {
            content: '>';
            color: var(--primary);
        }

        #resultsGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 1.5rem;
        }

        .image-card {
            background-color: var(--bg-gray-900);
            border: 1px solid var(--border-gray-800);
            border-radius: 1rem;
            overflow: hidden;
            transition: border-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }

        .image-card:hover {
            border-color: rgba(168, 85, 247, 0.5);
            transform: translateY(-4px);
            box-shadow: 0 18px 35px rgba(2, 6, 23, 0.65);
        }

        .image-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background-color: var(--bg-gray-800);
        }

        .image-info {
            padding: 1.25rem;
        }

        .image-meta {
            font-size: 0.85rem;
            color: var(--text-gray-400);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .image-meta strong {
            color: var(--text-white);
        }

        .image-actions {
            display: flex;
            gap: 0.75rem;
        }

        .btn-small {
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.65rem 0.9rem;
            border-radius: 0.65rem;
            border: 1px solid transparent;
        }

        .btn-download {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.9), rgba(59, 130, 246, 0.4));
            color: white;
        }

        .btn-download:hover {
            opacity: 0.9;
        }

        .btn-upload {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.9), rgba(236, 72, 153, 0.4));
            color: white;
        }

        .btn-upload:hover {
            opacity: 0.9;
        }

        @media (max-width: 1024px) {
            .pixabay-hero {
                padding: 2.25rem 2rem;
            }
        }

        @media (max-width: 640px) {
            .pixabay-container {
                padding-top: 3rem;
                padding-bottom: 3rem;
            }

            .pixabay-hero {
                padding: 2rem 1.5rem;
            }

            .pixabay-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .api-key-btn {
                width: 100%;
                justify-content: center;
            }

            input[type="text"],
            input[type="number"],
            select {
                border-radius: 0.65rem;
            }

            #resultsGrid {
                grid-template-columns: 1fr;
            }
        }

        .reset-api-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.65rem 1.25rem;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.15));
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 0.75rem;
            color: #fca5a5;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .reset-api-button:hover {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.2));
            border-color: rgba(239, 68, 68, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }

        .reset-api-button:active {
            transform: translateY(0);
        }

        /* Password gate styles (extracted from inline for consistency) */
        #password-gate-overlay { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.9); z-index:9999; }
        .password-gate-form { background:var(--gate-bg, var(--bg-gray-900)); padding:2rem; border:1px solid var(--gate-border, var(--border-gray-800)); border-radius:.75rem; max-width:320px; width:100%; font-family:system-ui; }
        .password-gate-form h2 { margin:0 0 1rem; font-size:1.2rem; color:var(--text-white); }
        .password-gate-form p { font-size:.75rem; color:var(--text-gray-400); line-height:1.3; margin:0 0 1rem; }
        .password-gate-input { width:100%; padding:.6rem .8rem; background:var(--gate-input-bg, var(--bg-gray-800)); border:1px solid var(--gate-input-border, var(--border-gray-800)); border-radius:.5rem; color:var(--gate-input-fg, var(--text-white)); margin-bottom:1rem; }
        .password-gate-submit { width:100%; background:var(--btn-primary-bg, var(--primary)); border:none; padding:.6rem 1rem; border-radius:.5rem; font-weight:600; cursor:pointer; color:var(--btn-primary-fg, #fff); }
        #password-gate-error { color:#f87171; font-size:.7rem; margin-top:.75rem; display:none; }
    </style>
</head>
<body class="bg-black text-white" data-theme="default">
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div id="password-gate-overlay">
        <form id="password-gate-form" class="password-gate-form">
            <h2>Protected Page</h2>
            <p>Enter password to view content.</p>
            <input type="password" id="password-gate-input" class="password-gate-input" placeholder="Password" />
            <button type="submit" class="password-gate-submit">Unlock</button>
            <div id="password-gate-error"></div>
        </form>
    </div>
    <div id="header-placeholder" data-template="header" data-root-path=""></div>

    <main id="main-content" class="container px-4 py-12 pixabay-container" role="main">
        <section class="pixabay-hero mb-10">
            <div class="space-y-6">
                <span class="pixabay-pill">Creative Tooling</span>
                <h1 class="pixabay-title font-bold leading-tight">üñºÔ∏è Pixabay Hero Image Fetcher</h1>
                <p class="pixabay-hero-copy text-gray-400">
                    Discover, resize, and export high-impact hero imagery without leaving the Quantum Investor toolkit. Set your preferred size once, explore curated results, and download production-ready assets in seconds.
                </p>
                <div class="pixabay-actions">
                    <button id="apiKeyButton" type="button" class="api-key-btn">üîë Set API Key</button>
                    <button id="resetApiButton" type="button" class="reset-api-button">üóëÔ∏è Reset API Keys</button>
                </div>
            </div>
            <div class="pixabay-meta">
                <div class="pixabay-meta-card">
                    <div class="pixabay-meta-label">Default Output</div>
                    <div class="pixabay-meta-value">1200 x 800</div>
                </div>
                <div class="pixabay-meta-card">
                    <div class="pixabay-meta-label">Formats</div>
                    <div class="pixabay-meta-value">WebP | JPG | PNG</div>
                </div>
                <div class="pixabay-meta-card">
                    <div class="pixabay-meta-label">Batch Size</div>
                    <div class="pixabay-meta-value">5-20 images</div>
                </div>
                <div class="pixabay-meta-card">
                    <div class="pixabay-meta-label">Workflow</div>
                    <div class="pixabay-meta-value">Download-ready assets</div>
                </div>
            </div>
        </section>

        <div id="status" class="status" role="status" aria-live="polite" style="display: none;"></div>

        <section class="pixabay-panel">
            <h2 class="text-xl font-semibold">Search Parameters</h2>
                    <div class="space-y-6">
                        <div class="form-group">
                            <label for="query">Search Query *</label>
                            <input type="text" id="query" placeholder="e.g., finance AI glow, stock market technology" required>
                            <p class="help-text">Combine 2-4 keywords to describe subject, mood, and motion.</p>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="category">Category</label>
                                <select id="category">
                                    <option value="">All Categories</option>
                                    <option value="backgrounds">Backgrounds</option>
                                    <option value="business">Business</option>
                                    <option value="computer">Computer</option>
                                    <option value="education">Education</option>
                                    <option value="science">Science</option>
                                    <option value="technology">Technology</option>
                                    <option value="nature">Nature</option>
                                    <option value="people">People</option>
                                    <option value="finance">Finance</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="colors">Color Filter</label>
                                <select id="colors">
                                    <option value="">Any Color</option>
                                    <option value="red">Red</option>
                                    <option value="orange">Orange</option>
                                    <option value="yellow">Yellow</option>
                                    <option value="green">Green</option>
                                    <option value="turquoise">Turquoise</option>
                                    <option value="blue">Blue</option>
                                    <option value="lilac">Lilac</option>
                                    <option value="pink">Pink</option>
                                    <option value="white">White</option>
                                    <option value="gray">Gray</option>
                                    <option value="black">Black</option>
                                    <option value="brown">Brown</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="perPage">Number of Results</label>
                                <select id="perPage">
                                    <option value="5" selected>5 images</option>
                                    <option value="10">10 images</option>
                                    <option value="15">15 images</option>
                                    <option value="20">20 images</option>
                                </select>
                                <p class="help-text">Start with 5 for quick scans, expand to 20 for deep dives.</p>
                            </div>
                        </div>

                        <h2 class="text-lg font-semibold pt-2">Image Settings</h2>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="width">Width (px)</label>
                                <input type="number" id="width" value="1200" min="100" max="4000">
                            </div>

                            <div class="form-group">
                                <label for="height">Height (px)</label>
                                <input type="number" id="height" value="800" min="100" max="4000">
                            </div>

                            <div class="form-group">
                                <label for="format">Output Format</label>
                                <select id="format">
                                    <option value="webp">WebP (recommended)</option>
                                    <option value="jpg">JPG</option>
                                    <option value="png">PNG</option>
                                </select>
                                <p class="help-text">WebP keeps quality high with lighter file sizes.</p>
                            </div>
                        </div>

                        <button type="button" class="btn-primary w-full">
                            <span id="searchBtnText">Search Images</span>
                        </button>
                    </div>
                </section>

        <section class="pixabay-panel mt-8">
            <h2 class="text-lg font-semibold">* Search Tips</h2>
            <ul class="pixabay-tip-list">
                <li>Pair a concept with a mood: "finance ai neon", "stocks volatility calm".</li>
                <li>Use the color filter to align with the homepage gradient palette.</li>
                <li>Include action verbs like "surge", "glow", or "connected" for motion.</li>
                <li>Keep people-focused searches to the "people" category for portraits.</li>
            </ul>
        </section>

        <div id="results" class="pixabay-panel mt-10" style="display: none;" role="region" aria-label="Image search results">
            <h2 class="text-xl font-semibold mb-4">Search Results</h2>
            <div id="resultsGrid"></div>
        </div>

        <section id="licenseInfo" class="pixabay-panel mt-8" style="display: none;">
            <h2 class="text-lg font-semibold mb-3">üìÑ Image Licenses</h2>

            <h3 class="text-md font-semibold mb-2 mt-4">Pixabay License</h3>
            <p class="text-sm" style="color: var(--text-gray-400); line-height: 1.7;">
                Pixabay images, videos, and audio are free to use for both personal and commercial projects, with no attribution required. You may adapt or modify the content, but you may not sell or redistribute it in its original form, nor claim it as your own trademark, brand, or logo. Content must not be used in illegal, misleading, offensive, or defamatory contexts. Some files may feature trademarks, logos, or identifiable people, which could require additional permissions for certain uses.
            </p>

            <h3 class="text-md font-semibold mb-2 mt-4">Pexels License</h3>
            <p class="text-sm" style="color: var(--text-gray-400); line-height: 1.7;">
                All photos and videos on Pexels are free to use for personal and commercial purposes with no attribution required. You can modify, copy, and distribute the content. However, identifiable people may not appear in a bad light or in a way that is offensive. You cannot sell unaltered copies of a photo or video, such as selling it as a stock photo, poster, print, or on a physical product without modifying it first. Attribution is appreciated but not required.
            </p>
        </section>
    </main>

    <div id="footer-placeholder" data-template="footer" data-root-path=""></div>

    <script src="js/template-loader.js" defer nonce="qi123"></script>
    <script src="js/mobile-menu.js" defer nonce="qi123"></script>
    <script src="js/password-gate.js" data-password-hash="18ae8ef593e3ad19525954a455f81cc50b0b5e6462dc95468eb4d43f9d8ea17d" defer nonce="qi123"></script>
    <script nonce="qi123">
        'use strict';

        // Constants
        const PIXABAY_API_URL = 'https://pixabay.com/api/';
        const PEXELS_API_URL = 'https://api.pexels.com/v1/search';
        const PIXABAY_KEY = 'pixabay_api_key';
        const PEXELS_KEY = 'pexels_api_key';

        // State
        let pixabayKey = localStorage.getItem(PIXABAY_KEY) || '';
        let pexelsKey = localStorage.getItem(PEXELS_KEY) || '';
        let currentImages = [];

        // DOM Elements (cached)
        const elements = {
            status: null,
            query: null,
            category: null,
            colors: null,
            perPage: null,
            width: null,
            height: null,
            format: null,
            searchBtn: null,
            searchBtnText: null,
            searchSpinner: null,
            results: null,
            resultsGrid: null
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', init);

        function init() {
            cacheElements();
            setupEventListeners();
            createApiKeyButtons();

            // Show message if no API keys
            if (!pixabayKey || !pexelsKey) {
                showStatus('Click "Set API Keys" to configure Pixabay and Pexels access', 'loading');
            }
        }

        function cacheElements() {
            elements.status = document.getElementById('status');
            elements.query = document.getElementById('query');
            elements.category = document.getElementById('category');
            elements.colors = document.getElementById('colors');
            elements.perPage = document.getElementById('perPage');
            elements.width = document.getElementById('width');
            elements.height = document.getElementById('height');
            elements.format = document.getElementById('format');
            elements.searchBtn = document.querySelector('.btn-primary');
            elements.searchBtnText = document.getElementById('searchBtnText');
            elements.results = document.getElementById('results');
            elements.resultsGrid = document.getElementById('resultsGrid');
        }

        function setupEventListeners() {
            elements.query.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchImages();
            });
            elements.searchBtn.addEventListener('click', searchImages);
        }

        function createApiKeyButtons() {
            const button = document.getElementById('apiKeyButton');
            if (button) {
                // Update button text if API keys exist
                const bothSet = pixabayKey && pexelsKey;
                if (bothSet) {
                    button.textContent = 'üîë Change API Keys';
                    button.style.opacity = '0.8';
                } else {
                    button.textContent = 'üîë Set API Keys';
                    button.style.opacity = '1';
                }

                button.addEventListener('click', resetApiKeys);
            }

            const resetButton = document.getElementById('resetApiButton');
            if (resetButton) {
                resetButton.addEventListener('click', clearAllAPIKeys);
            }
        }

        function promptForApiKeys() {
            const pixabayPrompt = prompt('Enter your Pixabay API key:\n\nGet free key at: https://pixabay.com/api/docs/');
            if (pixabayPrompt?.trim()) {
                pixabayKey = pixabayPrompt.trim();
                localStorage.setItem(PIXABAY_KEY, pixabayKey);
            }

            const pexelsPrompt = prompt('Enter your Pexels API key:\n\nGet free key at: https://www.pexels.com/api/');
            if (pexelsPrompt?.trim()) {
                pexelsKey = pexelsPrompt.trim();
                localStorage.setItem(PEXELS_KEY, pexelsKey);
            }

            if (pixabayKey && pexelsKey) {
                showStatus('API keys saved successfully!', 'success');
                const button = document.getElementById('apiKeyButton');
                if (button) {
                    button.textContent = 'üîë Change API Keys';
                    button.style.opacity = '0.8';
                }
            } else {
                showStatus('Both API keys are required', 'error');
            }
        }

        function resetApiKeys() {
            if (pixabayKey || pexelsKey) {
                const confirm = window.confirm('Do you want to change your API keys?');
                if (!confirm) return;
            }

            localStorage.removeItem(PIXABAY_KEY);
            localStorage.removeItem(PEXELS_KEY);
            pixabayKey = '';
            pexelsKey = '';
            promptForApiKeys();
        }

        function clearAllAPIKeys() {
            if (confirm('Are you sure you want to clear ALL stored API keys (GitHub, Pixabay, Pexels)? You will need to re-enter them on the next use.')) {
                // Remove all API keys
                const apiKeys = [
                    'github_token',
                    'pixabay_api_key',
                    'pexels_api_key'
                ];

                let clearedCount = 0;
                apiKeys.forEach(key => {
                    if (localStorage.getItem(key)) {
                        localStorage.removeItem(key);
                        clearedCount++;
                    }
                });

                // Reset local state
                pixabayKey = '';
                pexelsKey = '';

                if (clearedCount > 0) {
                    alert(`‚úÖ Successfully cleared ${clearedCount} API key(s) from browser storage.`);
                    // Update button text
                    const button = document.getElementById('apiKeyButton');
                    if (button) {
                        button.textContent = 'üîë Set API Keys';
                        button.style.opacity = '1';
                    }
                } else {
                    alert('‚ÑπÔ∏è No API keys found in browser storage.');
                }
            }
        }

        function showStatus(message, type) {
            elements.status.textContent = message;
            elements.status.className = `status ${type}`;
            elements.status.style.display = 'block';
        }

        function setLoadingState(isLoading) {
            elements.searchBtn.disabled = isLoading;
            elements.searchBtn.style.opacity = isLoading ? '0.6' : '1';
            elements.searchBtnText.textContent = isLoading ? 'Searching...' : 'Search Images';
        }

        async function searchImages() {
            const query = elements.query.value.trim();

            if (!query) {
                showStatus('Please enter a search query', 'error');
                return;
            }

            if (!pixabayKey || !pexelsKey) {
                promptForApiKeys();
                if (!pixabayKey || !pexelsKey) {
                    showStatus('Both API keys required', 'error');
                    return;
                }
            }

            setLoadingState(true);
            showStatus('Searching Pixabay & Pexels...', 'loading');

            try {
                const perPage = parseInt(elements.perPage.value);

                // Search both APIs in parallel
                const [pixabayResults, pexelsResults] = await Promise.all([
                    searchPixabay(query, perPage),
                    searchPexels(query, perPage)
                ]);

                // Merge results
                const allImages = [...pixabayResults, ...pexelsResults];

                if (allImages.length > 0) {
                    currentImages = allImages;
                    displayResults(allImages);
                    showStatus(`Found ${allImages.length} images (${pixabayResults.length} Pixabay, ${pexelsResults.length} Pexels)`, 'success');
                    elements.results.style.display = 'block';

                    // Show license info after results
                    const licenseInfo = document.getElementById('licenseInfo');
                    if (licenseInfo) licenseInfo.style.display = 'block';
                } else {
                    showStatus('No images found', 'error');
                }
            } catch (error) {
                showStatus(`Error: ${error.message}`, 'error');
                console.error('Search error:', error);
            } finally {
                setLoadingState(false);
            }
        }

        async function searchPixabay(query, perPage) {
            try {
                const params = buildPixabayParams(query, perPage);
                const response = await fetch(`${PIXABAY_API_URL}?${params}`);

                if (!response.ok) {
                    console.warn('Pixabay API error:', response.status);
                    return [];
                }

                const data = await response.json();
                return (data.hits || []).map(img => ({
                    ...img,
                    source: 'Pixabay',
                    previewURL: img.previewURL,
                    largeImageURL: img.largeImageURL || img.webformatURL
                }));
            } catch (error) {
                console.warn('Pixabay search failed:', error);
                return [];
            }
        }

        async function searchPexels(query, perPage) {
            try {
                const params = new URLSearchParams({
                    query: query,
                    per_page: perPage,
                    orientation: 'landscape'
                });

                const response = await fetch(`${PEXELS_API_URL}?${params}`, {
                    headers: {
                        'Authorization': pexelsKey
                    }
                });

                if (!response.ok) {
                    console.warn('Pexels API error:', response.status);
                    return [];
                }

                const data = await response.json();
                return (data.photos || []).map(photo => ({
                    id: photo.id,
                    source: 'Pexels',
                    previewURL: photo.src.medium,
                    largeImageURL: photo.src.large2x || photo.src.large,
                    webformatURL: photo.src.large,
                    imageWidth: photo.width,
                    imageHeight: photo.height,
                    user: photo.photographer,
                    tags: photo.alt || query,
                    likes: 0,
                    views: 0
                }));
            } catch (error) {
                console.warn('Pexels search failed:', error);
                return [];
            }
        }

        function buildPixabayParams(query, perPage) {
            const params = new URLSearchParams({
                key: pixabayKey,
                q: query,
                image_type: 'photo',
                orientation: 'horizontal',
                per_page: perPage,
                safesearch: 'true',
                order: 'popular'
            });

            const category = elements.category.value;
            const colors = elements.colors.value;

            if (category) params.append('category', category);
            if (colors) params.append('colors', colors);

            return params;
        }

        function displayResults(images) {
            elements.resultsGrid.innerHTML = '';

            images.forEach((img, index) => {
                const card = createImageCard(img, index);
                elements.resultsGrid.appendChild(card);
            });
        }

        function createImageCard(img, index) {
            const card = document.createElement('div');
            card.className = 'image-card';

            const preview = document.createElement('img');
            preview.src = img.previewURL;
            preview.alt = img.tags;
            preview.className = 'image-preview';
            preview.loading = 'lazy';

            const info = document.createElement('div');
            info.className = 'image-info';
            info.innerHTML = `
                <div class="image-meta">
                    <strong>${img.imageWidth} x ${img.imageHeight}</strong><br>
                    ${img.source === 'Pixabay' ? `üëç ${img.likes} | üëÅÔ∏è ${img.views}<br>` : ''}
                    Source: ${img.source}<br>
                    By: ${img.user}
                </div>
                <div class="image-actions">
                    <button type="button" class="btn-small btn-download" data-index="${index}">
                        Download
                    </button>
                    <button type="button" class="btn-small btn-upload" data-index="${index}">
                        Upload to Repo
                    </button>
                </div>
            `;

            const downloadBtn = info.querySelector('.btn-download');
            downloadBtn.addEventListener('click', () => downloadImage(index));

            const uploadBtn = info.querySelector('.btn-upload');
            uploadBtn.addEventListener('click', () => uploadToRepo(index));

            card.appendChild(preview);
            card.appendChild(info);

            return card;
        }

        async function downloadImage(index) {
            const img = currentImages[index];
            const format = elements.format.value;
            const targetWidth = Math.max(100, Math.min(4000, parseInt(elements.width.value, 10) || 1200));
            const targetHeight = Math.max(100, Math.min(4000, parseInt(elements.height.value, 10) || 800));

            showStatus('Processing image...', 'loading');

            try {
                const imageUrl = img.largeImageURL || img.webformatURL;
                const resizedBlob = await resizeImageFromUrl(imageUrl, targetWidth, targetHeight, format);

                downloadBlob(resizedBlob, `pixabay_${img.id}_${targetWidth}x${targetHeight}.${format}`);
                showStatus('Downloaded!', 'success');
            } catch (error) {
                showStatus(`Error: ${error.message}`, 'error');
                console.error('Download error:', error);
            }
        }

        async function resizeImageFromUrl(imageUrl, width, height, format) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';

                img.onload = () => {
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = width;
                        canvas.height = height;

                        const ctx = canvas.getContext('2d');
                        const scale = Math.max(width / img.width, height / img.height);
                        const scaledWidth = img.width * scale;
                        const scaledHeight = img.height * scale;
                        const x = (width - scaledWidth) / 2;
                        const y = (height - scaledHeight) / 2;

                        ctx.drawImage(img, x, y, scaledWidth, scaledHeight);

                        // Determine MIME type based on format
                        let mimeType;
                        if (format === 'png') {
                            mimeType = 'image/png';
                        } else if (format === 'webp') {
                            mimeType = 'image/webp';
                        } else {
                            mimeType = 'image/jpeg';
                        }

                        canvas.toBlob(
                            (blob) => {
                                if (blob) {
                                    resolve(blob);
                                } else {
                                    reject(new Error('Failed to create blob'));
                                }
                            },
                            mimeType,
                            0.95
                        );
                    } catch (error) {
                        reject(error);
                    }
                };

                img.onerror = () => reject(new Error('Failed to load image. CORS policy may be blocking the request.'));
                img.src = imageUrl;
            });
        }

        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        async function uploadToRepo(index) {
            const img = currentImages[index];
            const format = elements.format.value;
            const targetWidth = Math.max(100, Math.min(4000, parseInt(elements.width.value, 10) || 1200));
            const targetHeight = Math.max(100, Math.min(4000, parseInt(elements.height.value, 10) || 800));

            // Prompt for filename with validation
            let filename = prompt('Enter week number for filename (e.g., 7 for W7.webp):\n\nFormat: W{number}.webp', '');

            if (!filename) {
                showStatus('Upload cancelled', 'error');
                return;
            }

            // Clean and validate filename
            filename = filename.trim();

            // If user entered just a number, format it as W{n}
            if (/^\d+$/.test(filename)) {
                filename = `W${filename}`;
            }

            // If user entered W{n} format, keep it
            if (!/^W\d+$/i.test(filename)) {
                showStatus('Invalid format. Use W7, W6, etc.', 'error');
                return;
            }

            // Normalize to uppercase W and add extension
            filename = filename.toUpperCase() + `.${format}`;

            showStatus('Processing and uploading image...', 'loading');

            try {
                // Resize the image
                const imageUrl = img.largeImageURL || img.webformatURL;
                const resizedBlob = await resizeImageFromUrl(imageUrl, targetWidth, targetHeight, format);

                // Convert blob to base64
                const base64Content = await blobToBase64(resizedBlob);

                // Get GitHub token from localStorage
                const githubToken = localStorage.getItem('github_token');
                if (!githubToken) {
                    const token = prompt('Enter your GitHub Personal Access Token:\n\nRequired permissions: repo\n\nGet token at: https://github.com/settings/tokens');
                    if (!token?.trim()) {
                        showStatus('GitHub token required for upload', 'error');
                        return;
                    }
                    localStorage.setItem('github_token', token.trim());
                }

                // Upload to GitHub
                console.log('Starting GitHub upload for:', filename);
                console.log('Token length:', localStorage.getItem('github_token')?.length);

                const uploadResult = await uploadToGitHub(
                    filename,
                    base64Content.split(',')[1], // Remove data:image/... prefix
                    localStorage.getItem('github_token')
                );

                console.log('Upload result:', uploadResult);

                if (uploadResult.success) {
                    showStatus(`‚úÖ Uploaded as ${filename} and committed!`, 'success');
                } else {
                    showStatus(`‚ùå Upload failed: ${uploadResult.error}`, 'error');
                }
            } catch (error) {
                showStatus(`Error: ${error.message}`, 'error');
                console.error('Upload error details:', error);
            }
        }

        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        async function uploadToGitHub(filename, base64Content, token) {
            const owner = 'mig1980'; // Your GitHub username
            const repo = 'quantuminvestor'; // Your repo name
            const path = `Media/${filename}`;
            const branch = 'main';

            try {
                // Check if file exists (to get SHA for update)
                let sha = null;
                try {
                    const checkResponse = await fetch(
                        `https://api.github.com/repos/${owner}/${repo}/contents/${path}`,
                        {
                            method: 'GET',
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'User-Agent': 'Quantum-Investor-Blog'
                            }
                        }
                    );
                    if (checkResponse.ok) {
                        const data = await checkResponse.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    // File doesn't exist, that's fine
                    console.log('File check error:', e);
                }

                // Upload/update file
                const uploadResponse = await fetch(
                    `https://api.github.com/repos/${owner}/${repo}/contents/${path}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json',
                            'User-Agent': 'Quantum-Investor-Blog'
                        },
                        body: JSON.stringify({
                            message: `Add/Update hero image ${filename}`,
                            content: base64Content,
                            branch: branch,
                            ...(sha && { sha: sha })
                        })
                    }
                );

                if (!uploadResponse.ok) {
                    const errorData = await uploadResponse.json();
                    throw new Error(errorData.message || `GitHub API error: ${uploadResponse.status}`);
                }

                const result = await uploadResponse.json();
                return { success: true, data: result };
            } catch (error) {
                console.error('GitHub API error details:', error);
                return { success: false, error: `${error.message} (Check console for details)` };
            }
        }
    </script>
</body>
</html>
